@using tauri_browser.Models
@namespace tauri_browser.Components.Browser

<div class="tab-bar">
    <div class="tabs-scroll-area">
        @foreach (var tab in Tabs.OrderByDescending(t => t.IsPinned))
        {
            <div class="tab @(tab.Id == ActiveTabId ? "active" : "") @(tab.IsPinned ? "pinned" : "")" @onclick="() => OnSwitchTab.InvokeAsync(tab.Id)">
                <span class="tab-icon">
                   @if (tab.Url.StartsWith("lumina://") || tab.Url.StartsWith("lumina-app://"))
                   {
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="color: var(--accent-color);">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                        </svg>
                   }
                   else if (!string.IsNullOrEmpty(tab.FaviconUrl))
                   {
                       <img src="@tab.FaviconUrl" class="tab-icon" onerror="this.style.display='none'" />
                   }
                   else
                   {
                       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" />
                       </svg>
                   }
                </span>
                <span class="tab-title">@(string.IsNullOrEmpty(tab.Title) ? "Yeni Sekme" : tab.Title)</span>
                
                <span class="tab-pin-btn" @onclick="() => OnPinTab.InvokeAsync(tab.Id)" @onclick:stopPropagation title="@(tab.IsPinned ? "Unpin" : "Pin")">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 12px; height: 12px;">
                        <path fill-rule="evenodd" d="M11.47 2.47a.75.75 0 011.06 0l4.5 4.5a.75.75 0 01-1.06 1.06l-4.5-4.5a.75.75 0 010-1.06zm-5 5a.75.75 0 011.06 0l4.5 4.5a.75.75 0 01-1.06 1.06l-4.5-4.5a.75.75 0 010-1.06z" clip-rule="evenodd" />
                        <path d="M14.25 2.5a.75.75 0 00-.53.22l-8 8a.75.75 0 001.06 1.06l8-8a.75.75 0 00-.53-1.28z" />
                        <path d="M5.5 13.5L10.5 18.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <circle cx="12" cy="12" r="3" fill="currentColor" />
                        <!-- Simple Pin Shape -->
                        <path d="M16 2l-4 4-5 5 2 2 5-5 4-4-2-2z" />
                        <path fill-rule="evenodd" d="M12 2C10.895 2 10 2.895 10 4V6H9C7.895 6 7 6.895 7 8V9.586L5.293 11.293C4.902 11.683 4.902 12.317 5.293 12.707L11.293 18.707C11.683 19.098 12.317 19.098 12.707 18.707L14.414 17H16C17.105 17 18 16.105 18 15V14H20C21.105 14 22 13.105 22 12C22 10.895 21.105 10 20 10H18V4C18 2.895 17.105 2 16 2H12ZM16 4V10H16.414L14.707 11.707C14.317 12.098 13.683 12.098 13.293 11.707L7.293 5.707C6.902 5.317 6.902 4.683 7.293 4.293L9 2.586V4H16Z" clip-rule="evenodd" />
                    </svg>
                </span>

                <span class="tab-close" @onclick="() => OnCloseTab.InvokeAsync(tab.Id)" @onclick:stopPropagation>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 14px; height: 14px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </span>
            </div>
        }
    </div>
    <button class="new-tab-btn" @onclick="OnNewTab">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
    </button>
</div>

@code {
    [Parameter] public List<TabInfo> Tabs { get; set; } = new();
    [Parameter] public string ActiveTabId { get; set; } = "";
    [Parameter] public EventCallback<string> OnSwitchTab { get; set; }
    [Parameter] public EventCallback<string> OnCloseTab { get; set; }
    [Parameter] public EventCallback<string> OnPinTab { get; set; }
    [Parameter] public EventCallback OnNewTab { get; set; }
}
